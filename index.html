<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Particle Playground</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;700;800&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #050508;
    --panel-bg: rgba(255,255,255,0.04);
    --border: rgba(255,255,255,0.08);
    --text: #e8e8f0;
    --muted: rgba(232,232,240,0.4);
    --accent: #ff6b35;
    --accent2: #00d9ff;
    --accent3: #bf5fff;
  }

  html, body {
    width: 100%; height: 100%;
    background: var(--bg);
    color: var(--text);
    font-family: 'Syne', sans-serif;
    overflow: hidden;
    user-select: none;
  }

  canvas {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    cursor: crosshair;
    display: block;
  }

  /* HUD */
  #hud {
    position: fixed;
    top: 0; left: 0; right: 0;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 14px 20px;
    background: linear-gradient(to bottom, rgba(5,5,8,0.9), transparent);
    z-index: 10;
    pointer-events: none;
  }

  #title {
    font-size: clamp(14px, 3vw, 20px);
    font-weight: 800;
    letter-spacing: 0.08em;
    text-transform: uppercase;
  }
  #title span { color: var(--accent); }

  #stats {
    font-family: 'Space Mono', monospace;
    font-size: clamp(9px, 1.8vw, 12px);
    color: var(--muted);
    text-align: right;
    line-height: 1.6;
  }

  /* Controls Panel */
  #panel {
    position: fixed;
    bottom: 0; left: 0; right: 0;
    display: flex;
    align-items: flex-end;
    justify-content: center;
    gap: 8px;
    padding: 16px 12px;
    background: linear-gradient(to top, rgba(5,5,8,0.95) 60%, transparent);
    z-index: 10;
    flex-wrap: wrap;
  }

  .btn {
    font-family: 'Space Mono', monospace;
    font-size: clamp(9px, 2vw, 11px);
    letter-spacing: 0.05em;
    text-transform: uppercase;
    border: 1px solid var(--border);
    background: var(--panel-bg);
    color: var(--text);
    padding: 8px 14px;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.2s;
    backdrop-filter: blur(8px);
    white-space: nowrap;
  }
  .btn:hover { border-color: var(--accent); color: var(--accent); transform: translateY(-2px); }
  .btn.active { background: var(--accent); border-color: var(--accent); color: #000; }

  .slider-wrap {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
  }
  .slider-label {
    font-family: 'Space Mono', monospace;
    font-size: clamp(8px, 1.5vw, 10px);
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.08em;
  }
  input[type=range] {
    -webkit-appearance: none;
    width: clamp(60px, 10vw, 100px);
    height: 3px;
    background: var(--border);
    border-radius: 2px;
    outline: none;
    cursor: pointer;
  }
  input[type=range]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 12px; height: 12px;
    border-radius: 50%;
    background: var(--accent);
    border: 2px solid var(--bg);
  }

  #mode-label {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: clamp(28px, 8vw, 72px);
    font-weight: 800;
    color: rgba(255,255,255,0.03);
    letter-spacing: 0.1em;
    text-transform: uppercase;
    pointer-events: none;
    z-index: 1;
    transition: color 0.3s;
    text-align: center;
  }

  #hint {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%,-50%);
    text-align: center;
    z-index: 5;
    pointer-events: none;
    transition: opacity 0.5s;
  }
  #hint h2 {
    font-size: clamp(20px, 5vw, 42px);
    font-weight: 800;
    margin-bottom: 8px;
  }
  #hint p {
    font-family: 'Space Mono', monospace;
    font-size: clamp(10px, 2vw, 14px);
    color: var(--muted);
  }
  #hint.hidden { opacity: 0; }

  /* Color palette dots */
  #palette {
    display: flex; gap: 6px; align-items: center;
  }
  .color-dot {
    width: 18px; height: 18px;
    border-radius: 50%;
    cursor: pointer;
    border: 2px solid transparent;
    transition: transform 0.2s, border-color 0.2s;
  }
  .color-dot:hover { transform: scale(1.3); }
  .color-dot.active { border-color: white; transform: scale(1.2); }
</style>
</head>
<body>

<canvas id="c"></canvas>
<div id="mode-label">EXPLODE</div>

<div id="hud">
  <div id="title">Particle<span>.</span>Play</div>
  <div id="stats">
    <div id="stat-count">PARTICLES: 0</div>
    <div id="stat-fps">FPS: --</div>
  </div>
</div>

<div id="hint">
  <h2>Click & Drag</h2>
  <p>Touch / click anywhere to begin</p>
</div>

<div id="panel">
  <div id="palette">
    <div class="color-dot active" data-palette="fire" style="background: linear-gradient(135deg,#ff6b35,#ffcc00)"></div>
    <div class="color-dot" data-palette="ocean" style="background: linear-gradient(135deg,#00d9ff,#0052cc)"></div>
    <div class="color-dot" data-palette="galaxy" style="background: linear-gradient(135deg,#bf5fff,#ff2d78)"></div>
    <div class="color-dot" data-palette="nature" style="background: linear-gradient(135deg,#00ff87,#00b4d8)"></div>
    <div class="color-dot" data-palette="mono" style="background: linear-gradient(135deg,#fff,#888)"></div>
  </div>

  <button class="btn active" id="btn-explode">ðŸ’¥ Explode</button>
  <button class="btn" id="btn-trail">âœ¨ Trail</button>
  <button class="btn" id="btn-orbit">ðŸŒ€ Orbit</button>
  <button class="btn" id="btn-fountain">â›² Fountain</button>
  <button class="btn" id="btn-warp">ðŸŒŒ Warp</button>

  <div class="slider-wrap">
    <span class="slider-label">Size</span>
    <input type="range" id="sl-size" min="1" max="12" value="4">
  </div>
  <div class="slider-wrap">
    <span class="slider-label">Speed</span>
    <input type="range" id="sl-speed" min="1" max="10" value="5">
  </div>
  <div class="slider-wrap">
    <span class="slider-label">Gravity</span>
    <input type="range" id="sl-gravity" min="0" max="10" value="3">
  </div>

  <button class="btn" id="btn-clear">âœ• Clear</button>
</div>

<script>
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
const modeLabel = document.getElementById('mode-label');
const hint = document.getElementById('hint');
const statCount = document.getElementById('stat-count');
const statFps = document.getElementById('stat-fps');

let W, H;
function resize() {
  W = canvas.width = window.innerWidth;
  H = canvas.height = window.innerHeight;
}
resize();
window.addEventListener('resize', resize);

// State
let mode = 'explode';
let palette = 'fire';
let particles = [];
let mouse = { x: W/2, y: H/2, down: false, vx: 0, vy: 0, px: 0, py: 0 };
let frame = 0, lastTime = 0, fps = 60;
let interacted = false;

const PALETTES = {
  fire:   () => `hsl(${20 + Math.random()*50},100%,${50+Math.random()*30}%)`,
  ocean:  () => `hsl(${190 + Math.random()*50},100%,${50+Math.random()*30}%)`,
  galaxy: () => `hsl(${270 + Math.random()*80},100%,${55+Math.random()*30}%)`,
  nature: () => `hsl(${120 + Math.random()*80},100%,${45+Math.random()*30}%)`,
  mono:   () => `hsl(0,0%,${60+Math.random()*40}%)`,
};
const getColor = () => PALETTES[palette]();

const slSize    = document.getElementById('sl-size');
const slSpeed   = document.getElementById('sl-speed');
const slGravity = document.getElementById('sl-gravity');

const getSize    = () => parseFloat(slSize.value);
const getSpeed   = () => parseFloat(slSpeed.value);
const getGravity = () => parseFloat(slGravity.value) * 0.05;

// Particle class
class Particle {
  constructor(x, y, vx, vy, opts = {}) {
    this.x = x; this.y = y;
    this.vx = vx; this.vy = vy;
    this.life = 1;
    this.decay = opts.decay || (0.008 + Math.random() * 0.015);
    this.size = opts.size || (getSize() * (0.5 + Math.random() * 0.8));
    this.color = opts.color || getColor();
    this.gravity = opts.gravity !== undefined ? opts.gravity : getGravity();
    this.friction = opts.friction || 0.985;
    this.glow = opts.glow !== undefined ? opts.glow : true;
    this.trail = [];
    this.maxTrail = opts.maxTrail || 0;
  }

  update() {
    if (this.maxTrail > 0) {
      this.trail.push({ x: this.x, y: this.y, life: this.life });
      if (this.trail.length > this.maxTrail) this.trail.shift();
    }
    this.vy += this.gravity;
    this.vx *= this.friction;
    this.vy *= this.friction;
    this.x += this.vx;
    this.y += this.vy;
    this.life -= this.decay;
    this.size *= 0.997;
  }

  draw() {
    ctx.save();
    if (this.glow) {
      ctx.shadowBlur = this.size * 4;
      ctx.shadowColor = this.color;
    }

    // Trail
    if (this.trail.length > 1) {
      for (let i = 1; i < this.trail.length; i++) {
        const t = this.trail[i];
        const tp = this.trail[i-1];
        ctx.beginPath();
        ctx.moveTo(tp.x, tp.y);
        ctx.lineTo(t.x, t.y);
        ctx.strokeStyle = this.color;
        ctx.globalAlpha = (i / this.trail.length) * this.life * 0.4;
        ctx.lineWidth = (i / this.trail.length) * this.size * 0.5;
        ctx.stroke();
      }
    }

    ctx.beginPath();
    ctx.arc(this.x, this.y, Math.max(0.1, this.size * this.life), 0, Math.PI * 2);
    ctx.fillStyle = this.color;
    ctx.globalAlpha = this.life * this.life;
    ctx.fill();
    ctx.restore();
  }

  dead() { return this.life <= 0 || this.size < 0.2; }
}

// Emitters
function explode(x, y) {
  const count = 30 + Math.floor(Math.random() * 40);
  const spd = getSpeed();
  for (let i = 0; i < count; i++) {
    const angle = Math.random() * Math.PI * 2;
    const speed = (1 + Math.random() * 4) * spd * 0.4;
    particles.push(new Particle(x, y, Math.cos(angle)*speed, Math.sin(angle)*speed, {
      decay: 0.012 + Math.random()*0.01,
      maxTrail: 8,
    }));
  }
}

function trailEmit(x, y, vx, vy) {
  const spd = getSpeed();
  for (let i = 0; i < 4; i++) {
    particles.push(new Particle(x, y,
      vx * 0.3 + (Math.random()-0.5)*spd,
      vy * 0.3 + (Math.random()-0.5)*spd,
    { decay: 0.015, gravity: getGravity()*0.3, maxTrail: 15, size: getSize()*(0.3+Math.random()*0.6) }));
  }
}

function orbitEmit(x, y) {
  const count = 6;
  const spd = getSpeed();
  for (let i = 0; i < count; i++) {
    const angle = (i / count) * Math.PI * 2;
    const r = 30 + Math.random() * 30;
    particles.push(new Particle(
      x + Math.cos(angle)*r, y + Math.sin(angle)*r,
      Math.sin(angle)*spd*0.8, -Math.cos(angle)*spd*0.8,
    { decay: 0.005, gravity: 0, friction: 0.99, maxTrail: 20 }));
  }
}

function fountainEmit(x, y) {
  const spd = getSpeed();
  for (let i = 0; i < 5; i++) {
    const angle = -Math.PI/2 + (Math.random()-0.5)*0.8;
    const speed = (2+Math.random()*3)*spd*0.4;
    particles.push(new Particle(x, y, Math.cos(angle)*speed, Math.sin(angle)*speed, {
      decay: 0.006, gravity: getGravity()*1.5, maxTrail: 10,
    }));
  }
}

function warpEmit(x, y) {
  const spd = getSpeed();
  for (let i = 0; i < 3; i++) {
    const angle = Math.random()*Math.PI*2;
    const dist = 100 + Math.random()*150;
    const px2 = x + Math.cos(angle)*dist;
    const py2 = y + Math.sin(angle)*dist;
    const dx = x - px2, dy = y - py2;
    const len = Math.hypot(dx,dy);
    particles.push(new Particle(px2, py2,
      (dx/len)*spd*1.5, (dy/len)*spd*1.5,
    { decay: 0.02, gravity: 0, friction: 0.98, glow: true, maxTrail: 12 }));
  }
}

// Mode setups
const MODES = {
  explode:  { label: 'EXPLODE',  onDown: explode, onMove: null },
  trail:    { label: 'TRAIL',    onDown: null,    onMove: trailEmit },
  orbit:    { label: 'ORBIT',    onDown: orbitEmit, onMove: null },
  fountain: { label: 'FOUNTAIN', onDown: null,    onMove: fountainEmit, always: true },
  warp:     { label: 'WARP',     onDown: warpEmit, onMove: warpEmit },
};

function setMode(m) {
  mode = m;
  modeLabel.textContent = MODES[m].label;
  document.querySelectorAll('.btn[id^="btn-"]').forEach(b => b.classList.remove('active'));
  document.getElementById('btn-'+m).classList.add('active');
}

// Events
function getPos(e) {
  if (e.touches) {
    return { x: e.touches[0].clientX, y: e.touches[0].clientY };
  }
  return { x: e.clientX, y: e.clientY };
}

function onStart(e) {
  if (!interacted) { hint.classList.add('hidden'); interacted = true; }
  const {x,y} = getPos(e);
  mouse.down = true;
  mouse.px = x; mouse.py = y;
  mouse.x = x; mouse.y = y;
  mouse.vx = 0; mouse.vy = 0;
  const m = MODES[mode];
  if (m.onDown) m.onDown(x, y);
  e.preventDefault();
}

function onMove(e) {
  const {x,y} = getPos(e);
  mouse.vx = x - mouse.x;
  mouse.vy = y - mouse.y;
  mouse.px = mouse.x; mouse.py = mouse.y;
  mouse.x = x; mouse.y = y;
  if (mouse.down) {
    const m = MODES[mode];
    if (m.onMove) m.onMove(x, y, mouse.vx, mouse.vy);
  }
  e.preventDefault();
}

function onEnd(e) {
  mouse.down = false;
  e.preventDefault();
}

canvas.addEventListener('mousedown', onStart);
canvas.addEventListener('mousemove', onMove);
canvas.addEventListener('mouseup', onEnd);
canvas.addEventListener('touchstart', onStart, { passive: false });
canvas.addEventListener('touchmove', onMove, { passive: false });
canvas.addEventListener('touchend', onEnd, { passive: false });

// Button wiring
['explode','trail','orbit','fountain','warp'].forEach(m => {
  document.getElementById('btn-'+m).addEventListener('click', () => setMode(m));
});
document.getElementById('btn-clear').addEventListener('click', () => { particles = []; });

document.querySelectorAll('.color-dot').forEach(dot => {
  dot.addEventListener('click', () => {
    document.querySelectorAll('.color-dot').forEach(d => d.classList.remove('active'));
    dot.classList.add('active');
    palette = dot.dataset.palette;
  });
});

// Fountain continuous
let fountainInterval = null;

// Loop
let MAX_PARTICLES = 4000;

function loop(ts) {
  requestAnimationFrame(loop);
  const dt = ts - lastTime;
  lastTime = ts;
  fps = fps * 0.9 + (1000/Math.max(dt,1)) * 0.1;
  frame++;

  // Adaptive max particles based on perf
  if (fps < 30 && MAX_PARTICLES > 1000) MAX_PARTICLES -= 50;
  else if (fps > 55 && MAX_PARTICLES < 6000) MAX_PARTICLES += 10;

  // Fade background
  ctx.fillStyle = 'rgba(5,5,8,0.18)';
  ctx.fillRect(0,0,W,H);

  // Fountain always-emit while mouse down
  if (mouse.down && mode === 'fountain') {
    fountainEmit(mouse.x, mouse.y);
  }
  // Trail in warp: emit while down
  if (mouse.down && mode === 'warp' && frame % 2 === 0) {
    warpEmit(mouse.x, mouse.y);
  }

  // Update & draw
  for (let i = particles.length-1; i >= 0; i--) {
    const p = particles[i];
    p.update();
    if (p.dead()) { particles.splice(i,1); continue; }
    p.draw();
  }

  // Trim if too many
  if (particles.length > MAX_PARTICLES) {
    particles.splice(0, particles.length - MAX_PARTICLES);
  }

  // Stats every 20 frames
  if (frame % 20 === 0) {
    statCount.textContent = `PARTICLES: ${particles.length}`;
    statFps.textContent   = `FPS: ${Math.round(fps)}`;
  }
}

requestAnimationFrame(loop);
</script>
</body>
</html>